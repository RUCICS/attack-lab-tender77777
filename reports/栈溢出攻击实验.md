# 栈溢出攻击实验

## 题目解决思路


### Problem 1: 
- **分析**：Problem 1 的核心漏洞位于 func 函数（0x401232）中，该函数调用 strcpy 将用户输入复制到位于 rbp-0x8 的局部缓冲区，由于未检查输入长度导致栈溢出；为了劫持程序控制流，我们需要构造一个二进制 Payload，首先填充 **16字节** 的垃圾数据（8字节缓冲区 + 8字节 Saved RBP）以精确覆盖到栈上的返回地址，紧接着写入目标函数 func1 的入口地址 **0x401216**（64位小端序），从而使得 func 函数返回时直接跳转至 func1 并输出 "Yes!I like ICS!"
- **解决方案**：![屏幕截图 2026-01-17 161416](C:\Users\卢明晗\Pictures\Screenshots\屏幕截图 2026-01-17 161416.png)
- **结果**：![屏幕截图 2026-01-17 161405](C:\Users\卢明晗\Pictures\Screenshots\屏幕截图 2026-01-17 161405.png)

### Problem 2:
- **分析**：Problem 2 的核心在于利用 **ROP (Return Oriented Programming)** 技术绕过 NX 保护并进行函数传参。漏洞点位于 func 函数，memcpy 向 rbp-0x8 的缓冲区写入了 **56字节**，造成栈溢出；为了满足目标函数 func2 对第一个参数（rdi）必须为 **0x3f8** 的检查，我们需要构造 Payload：首先填充 **16字节** 覆盖 Saved RBP，接着写入程序中自带的 pop rdi; ret Gadget 地址（**0x4012c7**）及其参数 **0x3f8** 将数值加载到寄存器，最后写入 func2 的入口地址 **0x401216**，从而成功劫持控制流并打印出 "Yes!I like ICS!"。
- **解决方案**：![屏幕截图 2026-01-17 170117](C:\Users\卢明晗\Pictures\Screenshots\屏幕截图 2026-01-17 170117.png)
- **结果**：![屏幕截图 2026-01-17 170108](C:\Users\卢明晗\Pictures\Screenshots\屏幕截图 2026-01-17 170108.png)

### Problem 3: 
- **分析**：Problem 3 的难点在于可用的栈溢出空间极小（仅能覆盖返回地址后的 16-24 字节）且缺乏显式的 Gadget 来传递参数 0x72。通过分析目标函数 func1 的汇编代码，我发现其参数检查逻辑位于函数开头，且依赖于栈上的局部变量。为了绕过这一检查及参数传递的限制，我采用了 **Partial Overwrite / 直接跳转** 的策略：构造 Payload 填充 32 字节缓冲区，将 Saved RBP 覆盖为一个可读写的合法地址（如 .data 段地址 0x403510），并将返回地址直接覆盖为 func1 内部跳过参数检查后的指令地址 **0x40122b**。这样，程序在 func 返回时直接执行打印 "Your Luck number is 114" 的代码并随后调用 exit 正常退出，成功完成了攻击。
- **解决方案**：![image-20260117170812245](C:\Users\卢明晗\AppData\Roaming\Typora\typora-user-images\image-20260117170812245.png)
- **结果**：![image-20260117170803106](C:\Users\卢明晗\AppData\Roaming\Typora\typora-user-images\image-20260117170803106.png)

### Problem 4: 
- **分析**：本题开启了 Canary 栈保护。汇编代码显示，程序在 func 函数入口处（0x136c）将 **%fs:0x28** 处的随机值（Cookie）插入到栈帧底部的 **rbp-0x8** 位置；在函数返回前（0x140e），程序取出该值与原值进行异或或比较校验。如果攻击者试图溢出缓冲区覆盖返回地址，必然会先破坏该 Canary 值，导致校验失败并触发 __stack_chk_fail 终止程序
- **解决方案**：
- 本题利用逻辑漏洞绕过保护，无需溢出。汇编代码 0x13df 处存在指令 cmpl $0xffffffff, -0xc(%rbp)，直接判断输入是否等于 **-1**
- **结果**：![image-20260117171023466](C:\Users\卢明晗\AppData\Roaming\Typora\typora-user-images\image-20260117171023466.png)

